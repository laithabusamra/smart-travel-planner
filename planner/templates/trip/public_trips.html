{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/public_trips.css' %}">
{% endblock %}

{% block content %}
<div class="public-trips-container">
  <h1 class="page-title">ğŸŒ Explore Public Trips</h1>

  {% if public_trips %}
  <div class="trip-cards">
    {% for trip in public_trips %}
    <div class="trip-card">
    
      <div class="trip-header">
        <h2>{{ trip.title }}</h2>
        <p class="trip-author">By <strong>{{ trip.user.username }}</strong></p>
      </div>
      <p class="trip-destination">ğŸ“ {{ trip.destination }}</p>
      <p class="trip-date">ğŸ—“ {{ trip.start_date }} â†’ {{ trip.end_date }}</p>
      <p class="trip-budget">ğŸ’° {{ trip.budget }} JD</p>
      {% if trip.description %}
      <p class="trip-desc">{{ trip.description }}</p>
      {% endif %}

     
      <div class="reviews-section">
        <h3>ğŸ’¬ Reviews</h3>

        {% if trip.reviews.exists %}
          {% for review in trip.reviews.all %}
          <div class="review-card">
            <div class="review-header">
              <strong>{{ review.user.username|default:"Anonymous" }}</strong>
              <span class="review-rating">â­ {{ review.rating }}/5</span>
            </div>
            <p class="review-text">{{ review.comment }}</p>
            <small class="review-date">{{ review.created_at|date:"M d, Y" }}</small>
          
            {% if user.is_authenticated and review.user == user %}
            <div class="review-actions">
              <a href="{% url 'update_review' review.id %}" class="btn-edit">Edit</a>
              <form method="POST" action="{% url 'delete_review' review.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn-delete">Delete</button>
              </form>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        {% else %}
          <p class="no-reviews">No reviews yet. Be the first to share your experience!</p>
        {% endif %}

        
        {% if user.is_authenticated %}
        <form method="post" class="review-form">
          {% csrf_token %}
          <input type="hidden" name="trip_id" value="{{ trip.id }}">
          {{ form.as_p }}
          <button type="submit" class="btn-primary">Add Review</button>
        </form>
        {% else %}
        <p class="login-prompt">ğŸ”’ <a href="{% url 'login' %}">Login</a> to leave a review.</p>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="no-trips">No public trips yet ğŸ˜¢</p>
  {% endif %}
</div>
{% endblock %}
